---
title: "Homework_1"
author: "Toni Zarzosa and Berta Torrents"
output:
  pdf_document:
    toc: true
    toc_depth: 3
    number_sections: true
  word_document:
    toc: true
    toc_depth: '3'
    number_sections: true
  html_document:
    toc: true
    toc_depth: '3'
    df_print: paged
fontsize: 10pt
editor_options:
  chunk_output_type: console
---

# Clear directory and import libraries
```{r}
options(contrasts=c("contr.treatment","contr.treatment"))

if(!is.null(dev.list())) dev.off()
rm(list = ls())

library(readxl)
library(corrplot)
library(FactoMineR)
```

# Exploratory data analysis

## Import the data set to R correctly and assign player names as rownames of the data frame

The dataset has been imported with the *read_excel()* function from the *readxl* library. Using the *as.data.frame()* function, it has been converted to a data frame. 

The row names of the data frame have been assigned as the players' names. Moreover, the column containing the players' names has been removed from the data frame since it is no longer needed after being set as row names.
```{r}
df <- read_excel("data_Eurobasket_2025.xlsx")

df <- as.data.frame(df)

rownames(df) <- df$PLAYER

df <- df[,-1] # remove player column after setting it as a rowname
```

## Check the structure of the data and assign correct type to each variable considering whether it is a categorical or numerical variable

The *summary()* function reveals that this data frame has 17 numeric variables called “GP”, “MIN”, “FG”, “2PT.FG”, “3PT.FG”, “FT”, “OREB”, “DREB”, “REB”, “AST”, “PF”, “TO”, “STL”, “BLK”,  “+/-” , “EFF” and “PTS”. In addition, there are two categorical variables called “Team” and “Position”, which should be transformed into factors.

After assigning the correct type to each variable, the str function confirms that the structure of the data frame is properly defined.
```{r}
summary(df)

df$Team <- as.factor(df$Team)

df$Position <- as.factor(df$Position)

str(df)
```


## Create data frame only using variables “Position”, “MIN”, “FG”, “2PT.FG”, “3PT.FG”, “FT”, “OREB”, “DREB”, “REB”, “AST”, “PF”, “TO”, “STL”, “BLK”, “EFF” and “PTS”. Check the correlations between numerical variables and summarize your findings

A new data frame has been created based on the requested variables.

Moreover, the correlation matrix of the numeric variables in the new data frame has been computed. To visualize the correlation results, the *corrplot()* function from the *corrplot* library has been used.

The vast majority of the numerical variables are positively correlated. In fact, those that are negatively correlated have do show a strong relationship. The highest negative correlation is between “2PT.FG” and “3PT.FG”, with value of -0.311.

Nonetheless, there are some particular interesting positive correlations. To analyze these results more effectively, we will divide the study into three groups:

1) Very strong correlated variables (correlation > |0.90|):
- EFF and PTS (r = 0.95): Efficiency and points are almost perfectly correlated. These suggests that the more points a player scores, the more efficient is the player.

- DREB and REB (r = 0.97): Total rebounds is the sum of offensive rebounds and defensive rebounds. Nonetheless, it makes sense that defensive rebounds dominate total rebounds, since defensive rebounds are typically more frequent than offensive rebounds.

- EFF and DREB (r = 0.90): Players who grab defensive rebounds tend to have higher efficiency ratings.

2) Strong correlated variables (|0.90| > correlation > |0.80|):
- EFF and MIN (r = 0.83), MIN and PTS (r = 0.84): The more minutes a player spends on the court, the more points they tend to score, and, consequently, the higher their efficiency.

- OREB and REB (r = 0.87): Obviously, the total rebounds are correlated with offensive rebounds, since it contributes directly to the total number of rebounds.

- EFF and REB (r = 0.899): Usually, the more rebounds a player catches, the more efficient a player is.

- DREB and PTS (r = 0.817): The more defensive rebounds a player collects, the higher the probability of scoring, since each rebound creates an additional offensive opportunity, and therefore, more points can be scored.

3) Moderate correlated variables (|0.80| > correlation > |0.65|):

- AST and EFF (r = 0.666), EFF and TO (r = 0.761), AST and TO (r = 0.772): Efficiency is partly determined by assists and turnovers, so it makes sense that these variables are correlated. What is surprising, however, is that the correlation between efficiency and turnovers is positive, since a higher number of turnovers would normally be expected to reduce a player’s efficiency. On the other hand, the more assists a player makes, the more frequently they handle the ball, which naturally increases the likelihood of committing a turnover.

- EFF and OREB (r = 0.717): Efficiency is partly determined by offensive rebounds, so it makes sense that these variables are correlated.

- MIN - REB (r = 0.666), DREB - MIN (r = 0.731), AST - MIN (r = 0.707), MIN - TO (r = 0.663): The more minutes a player spends on the court, the more rebounds, assists, and turnovers they can make.

- 2PT FG - FG (r = 0.780): Usually, players who tend to score more two-point shots will have a higher overall field goal percentage. Notice that FG and 3PT.FG are negatively correlated, since three-point shots are generally more difficult to make and therefore lower the overall field goal percentage.

- DREB and OREB (r = 0.728): If a player is good at grabbing offensive rebounds, they are likely to be good at grabbing defensive rebounds as well.

- DREB - TO (r = 0.666): If a player grabs a defensive rebound, they immediately transition to offense, which increases the chances of losing the ball.

- PTS and TO (r = 0.761), PTS and REB (r = 0.788): The more points a player scores, the more frequently they handle the ball, which increases their probability of losing it. Similarly, the more rebounds a player collects, the higher their chances of scoring.

To summarize the previous ideas, it is clear that a player’s efficiency, the number of points they score, the minutes they spend on the court, and the rebounds they collect are highly correlated. It is also important to note that the MIN variable shows a moderate to strong correlation with almost all numerical variables. This makes complete sense, as the more time a player spends on the court, the higher all their recorded statistics are likely to be. Moreover, since the EFF variable is derived from individual performance indicators, it is expected to be correlated with them. However, because not all statistics contribute equally to a player’s efficiency, the strength of these correlations varies across variables.

```{r}
requested_var <- c("Position", "MIN", "FG", "2PT FG", "3PT FG", "FT", "OREB", "DREB", "REB", "AST", "PF", "TO", "STL", "BLK", "EFF", "PTS")

df_subset <- df[,requested_var]

cor_matrix <- cor(df_subset[,-1])

corrplot(cor_matrix, method = "number", tl.col = "black", title = "Correlation Matrix of Basketball Statistics")
```



# Application of PCA

## Apply PCA on the created data frame by using PCA() function in FactoMineR package and taking the variables “Position” and and “EEF” as supplemantary variables

## How many components should be extracted? Decide on the number of components considering eigenvalues

## Interpret variable plots. How can each dimension be named? Use plot.PCA() function to show correlations between variables and the extracted dimensions. (For the variables you should use the argument choix = “var”). Plot all the extracted dimensions changing argument “axes”.


## Show individual pilots for the extracted dimensions changing argument choix=“ind” in plot.PCA() function. Interpret the individual plots.

# Application of MDS

## Apply metric MDS using Euclidean distance on scaled numerical variables. Plot the data using the points on the first two coordinates using players names as label. Interpret the plot.

## Calculate gower distance including variable “POSITION” to the data matrix. Then apply metric MDS on gower distance matrix.

## Plot individual plots on the first two coordinates. Use different categorical and numerical variables as labels so as to explain clusters that are constructed.

## Which MDS do you think better group the individuals? Why?

# Application of MCA

## Convert the numerical variables to binary variables with two categories as “over average” and “below average” performances
A function has been created to convert the numerical variables into binary variables. Consequently, a new data frame called *df_binary* has been generated. After the categorization of the numerical variables, all variables in this new data frame are categorical, which makes it suitable for applying MCA.

```{r}
df_binary <- df_subset

binary <- function(x){
  ifelse(x > mean(x), "over_average", "below_average")
}

for(col in names(df_subset[,-1])) {
  df_binary[[col]] <- as.factor(binary(df_subset[[col]]))
}

summary(df_binary)
```


## Apply MCA on these variables and interpret your findings
The *MCA* function from the *FactoMineR* library has been applied to the *df_binary*.

Note that the maximum number of dimensions is defined as $ \min(n_{\text{obs}} - 1, K - J) $, where $ K $ is the total number of categories ($2 \cdot 15 + 3 = 33$) and $ J $ is the total number of categorical variables ($16$). Therefore, the maximum number of dimensions is $ 33 - 16 = 17 $.

The average inertia per dimension is $ \text{avg} = \frac{1}{K - J} = \frac{1}{17} $. Hence, the dimensions that should be retained are those whose eigenvalues are greater than the average inertia; in other words, those satisfying $ \lambda_i > \frac{1}{17} $.

After plotting a bar plot of the eigenvalues with a horizontal red line at $ h = \frac{1}{17} $, it can be observed that the dimensions to be retained are dimensions $1$, $2$ and $3$. Dimension $4$ lies on the threshold, as its eigenvalue is approximately equal to the average inertia.

In order to determine which categories contribute the most to each of the relevant dimensions, two complementary strategies have been applied. On the one hand, categories with higher $cos^2$ values in a given dimension are considered to contribute more strongly to that dimension. On the other hand, by examining the category cloud plots, we can visually observe how the dimensions separate the categories and which variables are most influential in defining the corresponding axes.

Dimension $1$ is clearly defined by the efficiency of a player. Other variables, such as the minutes played, points scored, number of rebounds, and turnovers, also contribute to shaping this dimension. Therefore, Dimension $1$ can be interpreted as the performance axis.

Moreover, considering the coordinates of the different categories, Dimension $1$ clearly separates the below_average categories from the over_average ones. The plot shows that all below_average categories are located on the left, whereas the over_average categories are on the right.

By examining the players’ positions in the graph, it becomes evident which players perform best and worst overall. Those positioned toward the right side of the first dimension, such as Alperen Şengün, Giannis Antetokounmpo, Mikael Jantunen, Lauri Markkanen and Isaac Bonga, are over_average in the majority of performance-related categories. On the other hand, those on the left side of the first dimension, such as Leon Kratzer, Sertac Sanli, Andre Gustavson, Ilari Seppala and Omer Faruk Yurtseven, are bellow_average in the majority of performance-related categories.

Dimension $2$ is clearly defined by the position of a player. Other variables, such as the percentage of 2pt field goals or the percentage field goals, also contribute to shaping this dimension. Therefore, Dimension $2$ can be interpreted as the playing style axis.

Moreover, considering the coordinates of the different categories, Dimension $2$ clearly separates the interior players (Centers and Forwards) from the exterior players (Guards).

Considering the coordinates of the different categories, the following patterns can be described for the main statistics:
- Center players tend to have over average values in variables such as 2PT.FG and FG, since they usually take shots close to the basket. Conversely, they tend to have below average values in 3PT.FG, as they rarely attempt long-distance shots.
- Forward players tend to commit more personal fouls and grab more offensive rebounds, as their role often involves defending opponents and fighting for rebounds under the basket.
- Guard players tend to have over average values in 3PT.FG, as they are typically responsible for taking shots from beyond the arc. On the other hand, their 2PT.FG and FG percentages are generally below average, since their shot attempts are usually made from longer distances and are therefore more difficult.

By examining the players’ positions in the graph, as it it expected, each player is close to their position.

Dimension $3$ also separates players to some extent according to their position; however, since the variance explained by this axis is considerably smaller, it is not as informative as the first two dimensions. This is expected, as the barplot of the eigenvalues clearly shows that dimensions $1$ and $2$ are the ones that best describe the variability of the data. 


```{r}
res.mca <- MCA(df_binary)

names(res.mca)

res.mca$eig
barplot(res.mca$eig[,1], main="Eigenvalues", names.arg=1:nrow(res.mca$eig))
abline(h = 1/17, col = "red")

res.mca$var$coord

res.mca$var
dimdesc(res.mca)

plot(res.mca,choix="var",title="Graph of the variables dim 1 vs 2")
plot(res.mca,choix="var",axes=c(2,3),title="Graph of the variables dim 2 vs 3")

# Exploring dimension 1

plot(res.mca,invisible=c("ind"),col.var=c(c("blue", "deepskyblue", "lightblue"), rep(c("black", "red"), 15)),title="Graph of the over/below average performance")

plot(res.mca,col.ind="green",col.var=c(c("blue", "deepskyblue", "lightblue"), rep(c("black", "red"), 15)),title="Graph of the over/below average performance with individuals")

sort(res.mca$ind$coord[, 1], decreasing = TRUE)[1:5]
sort(res.mca$ind$coord[, 1], decreasing = FALSE)[1:5]

# Exploring dimension 2

plot(res.mca,invisible=c("ind"),col.var=c(c("blue", "purple", "red"), rep("black",30)),title="Graph of the playing style performance")

plot(res.mca,col.ind="green",col.var=c(c("blue", "purple", "red"), rep("black",30)),title="Graph of the playing style performance with individuals")

# Exploring dimension 3

plot(res.mca,invisible=c("ind"),col.var=c(c("blue", "purple", "red"), rep("black",30)),axes=c(2,4),title="Graph of the playing style performance")

```















